{
  "rules": {
    "cv-app": {
      "users": {
        // Reglas para el nodo raíz "users" (solo admin puede listar todos los usuarios)
        ".read": "auth != null && root.child('cv-app/users/' + auth.token.email.replace('.', '_') + '/role').val() === 'admin'",
        ".write": "auth != null && root.child('cv-app/users/' + auth.token.email.replace('.', '_') + '/role').val() === 'admin'",
        
        // Reglas para cada usuario individual (acceso propio o admin)
        "$userEmailKey": {
          ".read": "
            auth != null && 
            (
              auth.token.email.replace('.', '_') == $userEmailKey || 
              root.child('cv-app/users/' + auth.token.email.replace('.', '_') + '/role').val() === 'admin'
            )
          ",
          ".write": "
            auth != null && 
            (
              auth.token.email.replace('.', '_') == $userEmailKey || 
              root.child('cv-app/users/' + auth.token.email.replace('.', '_') + '/role').val() === 'admin'
            )
          "
        }
      }
    }
  }
}

====================================================================================================================================

{
  "rules": {
    "cv-app": {
      "users": {
        // Reglas para el nodo raíz "users" (solo admin puede listar todos los usuarios)
        ".read": "auth != null && root.child('cv-app/users/' + auth.token.email.replace('.', '_') + '/metadata/role').val() === 'admin'",
        ".write": "auth != null && root.child('cv-app/users/' + auth.token.email.replace('.', '_') + '/metadata/role').val() === 'admin'",
        
        // Reglas para cada usuario individual (acceso propio o admin)
        "$userEmailKey": {
          ".read": "
            auth != null && 
            (
              auth.token.email.replace('.', '_') == $userEmailKey || 
              root.child('cv-app/users/' + auth.token.email.replace('.', '_') + '/metadata/role').val() === 'admin'
            )
          ",
          ".write": "
            auth != null && 
            (
              auth.token.email.replace('.', '_') == $userEmailKey || 
              root.child('cv-app/users/' + auth.token.email.replace('.', '_') + '/metadata/role').val() === 'admin'
            )
          ",
          
          // Subnodos específicos
          "metadata": {
            ".read": "auth != null",
            ".write": "auth != null && auth.token.email.replace('.', '_') == $userEmailKey || root.child('cv-app/users/' + auth.token.email.replace('.', '_') + '/metadata/role').val() === 'admin'"
          },
          
          "profileData": {
            ".read": "auth != null",
            ".write": "auth != null && auth.token.email.replace('.', '_') == $userEmailKey"
          },
          
          "cv-styles": {
            ".read": "auth != null",
            ".write": "auth != null && auth.token.email.replace('.', '_') == $userEmailKey"
          }
        }
      }
    }
  }
}